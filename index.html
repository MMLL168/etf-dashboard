<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETF å­˜è‚¡è¤‡åˆ©æˆ°æƒ…å®¤ (Pro ç‰ˆ)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .sidebar { background-color: #ffffff; min-height: 100vh; border-right: 1px solid #dee2e6; }
        .card { border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-radius: 10px; }
        .chart-container { position: relative; height: 400px; width: 100%; }
        .growth-badge { font-size: 0.9em; padding: 5px 10px; border-radius: 20px; background-color: #d1e7dd; color: #0f5132; }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-3 col-lg-2 sidebar p-3 d-none d-md-block">
            <h5 class="text-primary mb-4"><i class="bi bi-graph-up-arrow"></i> å­˜è‚¡æˆ°æƒ…å®¤</h5>
            
            <div class="card mb-3 border-primary">
                <div class="card-header bg-primary text-white small py-1 fw-bold">
                    <i class="bi bi-cloud-upload"></i> æ–°å¢/å„²å­˜è‡³é›²ç«¯
                </div>
                <div class="card-body p-2">
                    <div class="mb-2">
                        <label class="form-label small mb-1 text-muted">ETF æœå°‹ (ä»£ç¢¼/åç¨±)</label>
                        <input class="form-control form-control-sm" list="etfOptions" id="inputCode" placeholder="è¼¸å…¥ 00..." onchange="autoFillName()">
                        <datalist id="etfOptions">
                            </datalist>
                        <input type="hidden" id="inputName">
                    </div>
                    <div class="row g-1 mb-2">
                        <div class="col-6">
                            <input type="number" class="form-control form-control-sm" id="inputShares" placeholder="å¼µæ•¸" step="0.1">
                        </div>
                        <div class="col-6">
                            <input type="number" class="form-control form-control-sm" id="inputCost" placeholder="æˆæœ¬(é¸å¡«)">
                        </div>
                    </div>
                    <button class="btn btn-primary btn-sm w-100" id="btnSave" onclick="saveToGoogleSheet()">
                        <span id="btnText">å„²å­˜è¨­å®š</span>
                    </button>
                </div>
            </div>

            <div class="alert alert-light border mb-3 p-2">
                <small class="text-muted d-block mb-2">æ›´æ–°å¸‚å ´æ•¸æ“š (æ®–åˆ©ç‡)</small>
                <button class="btn btn-success btn-sm w-100" onclick="syncGoogleSheetData()">
                    <i class="bi bi-cloud-download"></i> åŒæ­¥ Google Sheet
                </button>
                <div id="syncStatus" class="small text-muted mt-1 text-center" style="font-size: 0.8em;"></div>
            </div>

            <div class="mb-3">
                <label class="form-label small text-muted">é¸æ“‡æˆ‘çš„æŒè‚¡</label>
                <select class="form-select" id="etfSelector" onchange="renderDashboard()">
                </select>
            </div>
            
            <div class="d-grid gap-2">
                <button class="btn btn-outline-danger btn-sm" onclick="resetData()">
                    <i class="bi bi-arrow-counterclockwise"></i> é‡ç½®æœ¬æ©Ÿå¿«å–
                </button>
            </div>
        </div>

        <div class="col-md-9 col-lg-10 p-4">
            <div class="d-md-none mb-3">
                <button class="btn btn-primary w-100 mb-2" data-bs-toggle="modal" data-bs-target="#mobileSaveModal">
                    <i class="bi bi-cloud-upload"></i> æ–°å¢æŒè‚¡
                </button>
                <select class="form-select mb-2" id="etfSelectorMobile" onchange="syncMobileSelect(this.value)">
                </select>
            </div>

            <h2 class="mb-4" id="dashboardTitle">è¼‰å…¥ä¸­...</h2>

            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card p-3 h-100 border-start border-5 border-primary">
                        <div class="text-muted small">ç›®å‰æŒæœ‰å¼µæ•¸</div>
                        <div class="h2 fw-bold mb-0" id="currentSharesDisplay">0</div>
                        <div class="text-muted small mt-2">åˆå§‹æŠ•å…¥ / æˆæœ¬: <span id="costDisplay">-</span></div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card p-3 h-100 border-start border-5 border-success">
                        <div class="text-muted small">å¹³å‡å¹´åŒ–æ®–åˆ©ç‡ (é ä¼°)</div>
                        <div class="h2 fw-bold mb-0 text-success" id="yieldDisplay">0%</div>
                        <div class="text-muted small mt-2">æ•¸æ“šä¾†æºï¼š<span id="dataSourceTag">è‡ªè¨‚</span></div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card p-3 h-100 border-start border-5 border-warning">
                        <div class="text-muted small">10 å¹´å¾Œé ä¼°ç´¯ç©</div>
                        <div class="h2 fw-bold mb-0 text-warning" id="futureSharesDisplay">0</div>
                        <div class="text-muted small mt-2">ç¸½è³‡ç”¢æˆé•· <span id="growthRateDisplay"></span></div>
                    </div>
                </div>
            </div>

            <div class="card p-4 mb-4">
                <h5 class="card-title">ğŸ“Š è¤‡åˆ©æˆé•·è¦–è¦ºåŒ– (10å¹´æ¨æ¼”)</h5>
                <div class="chart-container">
                    <canvas id="compoundChart"></canvas>
                </div>
            </div>

            <div class="card p-4">
                <h5 class="card-title">ğŸ“… å¹´åº¦æˆé•·é ä¼°è¡¨</h5>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>å¹´åº¦</th>
                                <th>ç´¯ç©å¼µæ•¸ (Shares)</th>
                                <th>å¢åŠ å¼µæ•¸ (ä¾†è‡ªè‚¡æ¯)</th>
                                <th>æˆé•·å€ç‡</th>
                            </tr>
                        </thead>
                        <tbody id="projectionTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="mobileSaveModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">æ–°å¢/å„²å­˜è‡³é›²ç«¯</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">ETF ä»£ç¢¼</label>
                    <input class="form-control" list="etfOptions" id="inputCodeMobile" onchange="document.getElementById('inputCode').value=this.value; autoFillName();">
                </div>
                <div class="mb-3">
                    <label class="form-label">å¼µæ•¸</label>
                    <input type="number" class="form-control" id="inputSharesMobile" onchange="document.getElementById('inputShares').value=this.value">
                </div>
                 <div class="mb-3">
                    <label class="form-label">æˆæœ¬</label>
                    <input type="number" class="form-control" id="inputCostMobile" onchange="document.getElementById('inputCost').value=this.value">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary w-100" onclick="saveToGoogleSheet();">ç¢ºèªå„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // ğŸ”§ è¨­å®šå€ (Config)
    // ============================================================
    
    // 1. Google Apps Script (è² è²¬å­˜æª”)
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbwa5A867o-bWRfzoMNuufTGYE-vdkmNlYs_mE6TwshaAgD-aZQQOQuQ8DKDrVCIUyVp/exec";

    // 2. Google Sheet CSV (è² è²¬è®€å–æ®–åˆ©ç‡) - å·²ä½¿ç”¨æ‚¨æä¾›çš„ MarketData åˆ†é é€£çµ
    const GOOGLE_SHEET_CSV_URL = '
